# Детекция и интерпретация темпоральных конструкций в русскоязычных текстах

Результаты и материалы [NLP хакатона](https://www.rsl.ru/ru/all-news/rgb-i-shkola-21-proveli-xakaton)

## Организаторы и участники: 

ПАО "[Сбербнк](https://www.sberbank.ru/)"

- Образовательная программа [Sber Graduate](https://sbergraduate.ru/)

    - [Школа 21](https://21-school.ru/)

- ФГБУ "[Российская госудрственная библиотека](https://rsl.ru)"

    - Проектный офис [Национальнй электронной библиотеки](https://nebrf.ru)
    - Лабортория исследованя и разработок
    - Отдел инженеров знаний

Время проведения: 27 ноября 2020 - 29 ноября 2020)
  
## Задча

В роамках Национальной цифровой (электронной) библиотеки ее оператороам Россйиской Государственной Библиотекой в 2020 году был запущен пилотный проект по оцифровке исторически значимых периодических изданий. Конечной целью является высокодоступое человеко- и машиночитаемое представление как самих выпусков, так и преработанный под платформы цифровой дистрибьюции текстовый и графический материал, а также высокоуровневые индексы сущностей, позволяющие работать с хронологией и связями, присутствующими в материали, осуществлть их фактологическую интеграцию с материалами из других источников.

Значительной проблемой для высокоуровнего автоматизированного анализа являлось остуствие специализированных механизмов для работы с темпоральными конструкциями русского языка. Формирование такиех инструментов, пригодных к широкому применению и работающих с гарантированно высоким качеством и стало отправной точкой совместного хакатона. 

Команды, участвующие в хакатоне должны в качестве результата работы предоставить совокупность данных и программных решений, из которых возможно сформировать процесс:

- Машинночитаемый корпус темпоральных конструкций русского языка, на момент завершения мероприятия явяющийся уникальной разработкой. С помощью этого корпуса осуществлялась многосторонняя проверка и оценка качества автоматизированных систем (Test suites).

- Произвести качественную верефикацию корпуса и исправить как ошибки расшифровки темпоральных значений, так выявить субоптимальные моменты в технической конвенции и причницпах кодирования значений. 

- Программные решения, осуществляющие:
 * Выделение из общего объема текстового материала на выходе пилотной системы оцифровки периодических изданий.
 * Интерпретацию выделенных фрагментов с привязкой к конкретной временной точке на временной шкале, дающей начало для отсчета сдвигов временного контекста.

- Прототип полного стека временного индекса на основе материала оцифровки изданий газеты "Красная Звезда" за период 1941 - 1945 г. (1539 выпусков), включая систему развертывания и работоспособную клиентсмую часть.


Кроме готовящегося к публикации кода решений, публикуется корпус темпоральных конструкций и анализ расхождений корпуса и резулььтатов "слепой" верефикации интерпретации датировок и относительных временнх интервалов.

Конечным назначением материалов корпуса является не только тестирование работы ПО, но и локализации расширения стандарта ISO 8601:2004, описывающего синтаксис и методику спецтализированной разметки временной тематики ISO TimeML 1.2.1, закрепленым как официально расширение российского стандарта ГОСТ Р 7.0.64-2018. 

В качестве дополнительных материалов публикуется полный объем текстовых фрагментов, полученных в результате оцифровки с привязкой к выпуску, странице и расположению на ней.

Также, в ближайшее время будут опубликовны "сырые" данные NER индекса, содержащий упоминания персоналий, организаций и географических локаций.

### Материалы корпуса:

- [Площадка на платьформе Kaggle](https://www.kaggle.com/c/retropress-temporal-markup/)

  На ней где осуществляось "Слепое" тестирование решений и "слепая верификация третьей ревизии корпуса, данная методика предполагает, что разработчик программы или специалист, осуществляющий разметку не имеет доступа к референсной разметке, но может получить статистически метрики сходства своего варианта с закрытым образцом. 
- [Файл третьей ревизии корпуса](corpora/temporal-corpora-ru-rev3-kaggle-test.csv) адаптированный под Kaggle формат Kaggle
- [Лучшие результаты](corpora/temporal-corpora-ru-rev3-kaggle-best-team-noobs.csv) верификации дешивроко дат от команды **Нубы**, получившей наилучший показатель совпадений с образцом вслепую. И [анализ проблем](corpora/temporal-corpora-ru-rev3-best-team-conflicts-resolution.csv) выявленных в ходе верификации третьей ревизии корпуса командами, занимающимися верефикацией

### Использованные материалы оцифровки и каталогизации

- [Мащинночитаемый вовод системы оцифровки](data/red-star-1941-1945-text-blocks) разделенный по отдельным выпускам в формате `TSV`. 
- [Набор образцов указания даты издания](data/heritage-registry-overhumanized-publication-dates.tsv) разделенный на рабочую и проверочную часть с разметкой TIMEX2. В качестве источника использован реестр фежерального проекта "[Реестр книжных памфтников](https://knpam.rusneb.ru)". В дальнейшем этот блок данных будет добавлен в основной корпус. 

### Технические детали формата даты, использованные в процессе тестирования корпуса

С целью экономии времени, которое потребовалось бы участникам для ознакомления со стандартами специализированной разметки, а также более просто адаптации под произвольный дизайн программных систем, технический формат, используемый в рамках работы РГБ (Facebook [Duckling2](https://github.com/facebook/duckling) corpus file, [ISO TimeM L1.2.1 + TIMEX3](http://www.timeml.org)) был упрощен

Стандартные значения дат и времени задаются в формате [ГОСТ Р 7.0.64-2018](http://protect.gost.ru/v.aspx?control=8&baseC=-1&page=0&month=-1&year=-1&search=&RegNum=1&DocOnPageCount=15&id=222978) 
"_Система стандартов по информации, библиотечному и издательскому делу. Представление дат и времени. Общие требования_" (модификация стандрта [ISO 8601:2004](https://www.iso.org/standard/40874.html))

* Не используется часть стандарта ISO:8601, где определен формат задания временной протяженности. 
* Для указания временных значений используется расширенная (extended) форма нотации, если таковая описана для используемого типа временной отметки.
* Гранулярность точечного времени или границ интервала могла быть с точностью в рамках календарного года, месяца, дня. И время до целых часов, минут или секунд.
* Для указания интервалов использовался разделитель в виде знака минус с двумя пробелами по бокам: ` - `
* Обе границы интервалов считались включенными в него по минимальной или максимальной границе своего определения.
* Ввод и вывод осуществляется в формате comma separated values, экранирование символов с помощью взятия значения в двройные кавычки: `"this value, comma contains".

Пример: 
```csv
"Id","Expected"
"с одиннадцати тридцати утра до часу тридцати дня","2020-11-27T11:30 - 2020-11-27T13:30"
"с 18 по 27 января 1942 года","1942-01-18 - 1942-01-27"
```

Интервал содержит такой же формат дат, что и точечные даты.

## Итоговый счет команд

Рассчитан относительно [ре-верифицированной третьей ревизии корпуса](corpora/temporal-corpora-ru-rev3-resolved.csv) в которой экспертно были [разрешены конфликты](data/temporal-corpora-ru-rev3-kaggle-best-team-noobs.csv) между образцом и вариантами лучшей команды, осуществившей ручную верификацию вслупую (указывали свой вариат расшифровки, не зная варианта, указанного в образце).

Не-верифицированная версия корпуса также оценивается, указанная как "команда" `REFERENCE-temporal-corpora-rev3`

| Лучший счет (от 0.0 до 1.0) | Команда | Попытка |
| --- | --- | --- |
| 0.739691 | Нубы | 18340935 - Pub_0_72809 Priv_0_72809.csv |
| 0.706186 | handcrafted_solution | 18340316 - Pub_0_71280 Priv_0_71280.csv |
| 0.634021 | MyParser | 18338306 - Pub_0_63445 Priv_0_63445.csv |
| 0.564433 | Inception | 18345704 - Pub_0_57603 Priv_0_57603.csv |
| 0.422680 | Evgenii Chernov | 18356977 - Pub_0_44329 Priv_0_44329.csv |
| 0.342784 | ElenaKiseleva | 18344287 - Pub_0_35567 Priv_0_35567.csv |
| 0.337629 | Dmitry Mikhaylenko | 18356650 - Pub_0_33762 Priv_0_33762.csv |
| 0.311856 | monuwio | 18335692 - Pub_0_30927 Priv_0_30927.csv |
| 0.265464 | Microvolnovka | 18358494 - Pub_0_26804 Priv_0_26804.csv |
| 0.188144 | Cheliki | 18356678 - Pub_0_19329 Priv_0_19329.csv |
| 0.146907 | 21-coders | 18354574 - Pub_0_15670 Priv_0_15670.csv |
| 0.118557 | Red-alert | 18358781 - Pub_0_16907 Priv_0_16907.csv |
| 0.110825 | Shrugged | 18346254 - Pub_0_12371 Priv_0_12371.csv |
| 0.087629 | schips_21 | 18339604 - Pub_0_09278 Priv_0_09278.csv |
| 0.051546 | Le-Coqs | 18358425 - Pub_0_05927 Priv_0_05927.csv |
| 0.048969 | hrambton | 18339879 - Pub_0_05154 Priv_0_05154.csv |
| 0.043814 | sisidra | 18362353 - Pub_0_04381 Priv_0_04381.csv |
| 0.010309 | MLaureen | 18351980 - Pub_0_01546 Priv_0_01546.csv |
| 0.837629 | REFERENCE-temporal-corpora-rev3 | temporal-corpora-ru-rev3-kaggle-test.csv |

Таблица с итоговым счетом [в формате TSV](stats/leaderboard.tsv).

Для дальнейшей работы над корпусом к результатам прилагается **таблица сложности образцов для анализа** [в формате TSV](stats/hardness.tsv) 

В ней строки, формирующие третью ревизию корпуса, упорядоченны в порядке увеличения частоты правильного распознавания относительно попытки с лучшим счетом для каждой из команд.

Образцом считается [ре-верефицированной версией третьей ревизии корпуса](corpora/temporal-corpora-ru-rev3-resolved.csv)

Не-верифицированная версия корпуса указана как "команда" `REFERENCE-temporal-corpora-rev3`

### Воспроизведение оценки

Воспроизвести оценку можно запустив утилиту `rank.py` из корня этого репозитория, выдающую результат в формате TSV и запускаемую в одном из двух режимов (по-умолчанию: `rank`):

```shell script
$ python3 stats/score.py rank
$ python3 stats/score.py hardness
```

Утилита требует наличие установленного [Python 3](https://www.python.org/download/releases/3.0/).

Установка внешних зависимостей для утилиты не требуется.
